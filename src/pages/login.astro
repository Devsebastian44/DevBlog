---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";

const title = "Login | DevBlog";
---

<Layout title={title}>
    <Header />
    <main
        class="flex-grow grid place-items-center relative overflow-hidden py-20 px-4"
    >
        <!-- Background Elements -->
        <div class="absolute inset-0 pointer-events-none">
            <div
                class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] mix-blend-screen opacity-30"
            >
            </div>
            <div
                class="absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[120px] mix-blend-screen opacity-30"
            >
            </div>
        </div>

        <div class="w-full max-w-md relative z-10">
            <div
                class="bg-white/80 dark:bg-[#0b1618] border border-slate-200 dark:border-[#224249] rounded-2xl p-8 shadow-2xl backdrop-blur-sm"
            >
                <div class="text-center mb-8">
                    <h1
                        class="font-display font-bold text-3xl text-slate-900 dark:text-white mb-2"
                    >
                        Welcome Back
                    </h1>
                    <p class="text-slate-500 text-sm">
                        Please enter your details to login
                    </p>
                </div>

                <form class="space-y-6" id="login-form">
                    <div>
                        <label
                            for="email"
                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2"
                            >Email</label
                        >
                        <input
                            type="email"
                            id="email"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="your@email.com"
                        />
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label
                                for="password"
                                class="block text-xs font-bold text-slate-500 uppercase tracking-widest"
                                >Password</label
                            >
                            <a
                                href="#"
                                class="text-xs text-primary hover:text-primary-dark font-medium transition-colors"
                                >Forgot password?</a
                            >
                        </div>
                        <input
                            type="password"
                            id="password"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="••••••••"
                        />
                    </div>

                    <div
                        id="error-message"
                        class="hidden text-red-500 text-sm text-center bg-red-500/10 p-2 rounded-lg border border-red-500/20"
                    >
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3.5 rounded-xl shadow-lg shadow-primary/25 hover:shadow-primary/40 transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Login
                    </button>

                    <div class="relative py-2">
                        <div class="absolute inset-0 flex items-center">
                            <div
                                class="w-full border-t border-slate-200 dark:border-[#224249]"
                            >
                            </div>
                        </div>
                        <div
                            class="relative flex justify-center text-xs uppercase"
                        >
                            <span
                                class="bg-white dark:bg-[#0b1618] px-2 text-slate-500 font-medium"
                                >Or continue with</span
                            >
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <button
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-200 dark:border-[#224249] rounded-xl hover:bg-slate-50 dark:hover:bg-[#162a2f] transition-colors group"
                        >
                            <span
                                class="font-bold text-sm text-slate-600 dark:text-slate-300"
                                >Google</span
                            >
                        </button>
                        <button
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-200 dark:border-[#224249] rounded-xl hover:bg-slate-50 dark:hover:bg-[#162a2f] transition-colors group"
                        >
                            <span
                                class="font-bold text-sm text-slate-600 dark:text-slate-300"
                                >GitHub</span
                            >
                        </button>
                    </div>
                </form>

                <div class="mt-8 text-center">
                    <p class="text-sm text-slate-500">
                        Don't have an account?
                        <a
                            href="/register"
                            class="text-primary hover:text-primary-dark font-bold hover:underline transition-colors"
                            >Sign Up</a
                        >
                    </p>
                </div>
            </div>
        </div>
    </main>
</Layout>

<script>
    import { supabase } from "../lib/supabase";

    const form = document.getElementById("login-form") as HTMLFormElement;
    const emailInput = document.getElementById("email") as HTMLInputElement;
    const passwordInput = document.getElementById(
        "password",
    ) as HTMLInputElement;
    const errorMessage = document.getElementById("error-message");
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = emailInput.value;
        const password = passwordInput.value;

        // Reset error
        if (errorMessage) {
            errorMessage.textContent = "";
            errorMessage.classList.add("hidden");
        }

        // Disable button
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = "Logging in...";
        }

        try {
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password,
            });

            if (error) {
                throw error;
            }

            // Success - redirect to home
            window.location.href = "/";
        } catch (error: any) {
            if (errorMessage) {
                errorMessage.textContent = error.message || "Error logging in";
                errorMessage.classList.remove("hidden");
            }
        } finally {
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = "Login";
            }
        }
    });
</script>
