---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";

const title = "Sign Up | DevBlog";
---

<Layout title={title}>
    <Header />
    <main
        class="flex-grow grid place-items-center relative overflow-hidden py-20 px-4"
    >
        <!-- Background Elements -->
        <div class="absolute inset-0 pointer-events-none">
            <div
                class="absolute top-[-10%] left-[-5%] w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] mix-blend-screen opacity-30"
            >
            </div>
            <div
                class="absolute bottom-[-10%] right-[-5%] w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[120px] mix-blend-screen opacity-30"
            >
            </div>
        </div>

        <div class="w-full max-w-md relative z-10">
            <div
                class="bg-white/80 dark:bg-[#0b1618] border border-slate-200 dark:border-[#224249] rounded-2xl p-8 shadow-2xl backdrop-blur-sm"
            >
                <div class="text-center mb-8">
                    <h1
                        class="font-display font-bold text-3xl text-slate-900 dark:text-white mb-2"
                    >
                        Create Account
                    </h1>
                    <p class="text-slate-500 text-sm">
                        Join our developer community
                    </p>
                </div>

                <form class="space-y-5" id="register-form">
                    <div>
                        <label
                            for="name"
                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2"
                            >Full Name</label
                        >
                        <input
                            type="text"
                            id="name"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="John Doe"
                        />
                    </div>

                    <div>
                        <label
                            for="email"
                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2"
                            >Email</label
                        >
                        <input
                            type="email"
                            id="email"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="your@email.com"
                        />
                    </div>

                    <div>
                        <label
                            for="password"
                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2"
                            >Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="••••••••"
                        />
                    </div>

                    <div>
                        <label
                            for="confirm-password"
                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2"
                            >Confirm Password</label
                        >
                        <input
                            type="password"
                            id="confirm-password"
                            required
                            class="w-full bg-slate-50 dark:bg-[#162a2f] text-slate-900 dark:text-white px-4 py-3 rounded-xl border border-slate-200 dark:border-transparent focus:border-primary/50 focus:ring-2 focus:ring-primary/20 outline-none transition-all placeholder:text-slate-400"
                            placeholder="••••••••"
                        />
                    </div>

                    <div class="flex items-start gap-2 pt-2">
                        <input
                            type="checkbox"
                            id="terms"
                            class="mt-1 rounded border-slate-300 text-primary focus:ring-primary bg-slate-50 dark:bg-[#162a2f] dark:border-slate-700"
                            required
                        />
                        <label for="terms" class="text-xs text-slate-500">
                            I agree to the <a
                                href="#"
                                class="text-primary hover:underline"
                                >Terms of Service</a
                            > and <a
                                href="#"
                                class="text-primary hover:underline"
                                >Privacy Policy</a
                            >.
                        </label>
                    </div>

                    <div
                        id="error-message"
                        class="hidden text-red-500 text-sm text-center bg-red-500/10 p-2 rounded-lg border border-red-500/20"
                    >
                    </div>
                    <div
                        id="success-message"
                        class="hidden text-green-500 text-sm text-center bg-green-500/10 p-2 rounded-lg border border-green-500/20"
                    >
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3.5 rounded-xl shadow-lg shadow-primary/25 hover:shadow-primary/40 transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Sign Up
                    </button>

                    <div class="relative py-2">
                        <div class="absolute inset-0 flex items-center">
                            <div
                                class="w-full border-t border-slate-200 dark:border-[#224249]"
                            >
                            </div>
                        </div>
                        <div
                            class="relative flex justify-center text-xs uppercase"
                        >
                            <span
                                class="bg-white dark:bg-[#0b1618] px-2 text-slate-500 font-medium"
                                >Or join with</span
                            >
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <button
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-200 dark:border-[#224249] rounded-xl hover:bg-slate-50 dark:hover:bg-[#162a2f] transition-colors group"
                        >
                            <span
                                class="font-bold text-sm text-slate-600 dark:text-slate-300"
                                >Google</span
                            >
                        </button>
                        <button
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-200 dark:border-[#224249] rounded-xl hover:bg-slate-50 dark:hover:bg-[#162a2f] transition-colors group"
                        >
                            <span
                                class="font-bold text-sm text-slate-600 dark:text-slate-300"
                                >GitHub</span
                            >
                        </button>
                    </div>
                </form>

                <div class="mt-8 text-center">
                    <p class="text-sm text-slate-500">
                        Already have an account?
                        <a
                            href="/login"
                            class="text-primary hover:text-primary-dark font-bold hover:underline transition-colors"
                            >Login</a
                        >
                    </p>
                </div>
            </div>
        </div>
    </main>
</Layout>

<script>
    import { supabase } from "../lib/supabase";

    const form = document.getElementById("register-form") as HTMLFormElement;
    const nameInput = document.getElementById("name") as HTMLInputElement;
    const emailInput = document.getElementById("email") as HTMLInputElement;
    const passwordInput = document.getElementById(
        "password",
    ) as HTMLInputElement;
    const confirmPasswordInput = document.getElementById(
        "confirm-password",
    ) as HTMLInputElement;
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = nameInput.value;
        const email = emailInput.value;
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Reset messages
        if (errorMessage) {
            errorMessage.textContent = "";
            errorMessage.classList.add("hidden");
        }
        if (successMessage) {
            successMessage.textContent = "";
            successMessage.classList.add("hidden");
        }

        // Validate passwords
        if (password !== confirmPassword) {
            if (errorMessage) {
                errorMessage.textContent = "Passwords do not match.";
                errorMessage.classList.remove("hidden");
            }
            return;
        }

        if (password.length < 6) {
            if (errorMessage) {
                errorMessage.textContent =
                    "Password must be at least 6 characters long.";
                errorMessage.classList.remove("hidden");
            }
            return;
        }

        // Disable button
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = "Registering...";
        }

        try {
            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        full_name: name,
                    },
                },
            });

            if (error) {
                throw error;
            }

            // Success
            if (successMessage) {
                successMessage.textContent =
                    "Registration successful! Please check your email to confirm your account.";
                successMessage.classList.remove("hidden");
            }
            form.reset();
        } catch (error: any) {
            if (errorMessage) {
                errorMessage.textContent = error.message || "Error registering";
                errorMessage.classList.remove("hidden");
            }
        } finally {
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = "Sign Up";
            }
        }
    });
</script>
